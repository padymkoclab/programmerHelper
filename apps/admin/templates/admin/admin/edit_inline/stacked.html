
{% load i18n %}

{% load utils_filters %}

{% load admin_filters %}

{{ formset.management_form }}

<div class="row">
    <div class="col-sm-12 text-right">
        <button type="button" class="btn btn-primary open_all_panels">{% trans "Open all panels" %}</button>
        <button type="button" class="btn btn-primary collapse_all_panels">{% trans "Collapse all panels" %}</button>
    </div>
</div>

{% if formset.non_form_errors %}
    {% for error in formset.non_form_errors %}
        <p class="text-danger">{{ error }}</p>
    {% endfor %}
{% endif %}


{% for form in formset %}

    {% if form.non_field_errors %}
        {% for error in form.non_field_errors %}
            <p class="text-danger">{{ error }}</p>
        {% endfor %}
    {% endif %}

    {% with forloop.counter|stringformat:'s' as forloop_count %}
        {% with 'accordion'|add:number_inline|add:forloop_count as accordion_id %}

            <div class="panel-group object_panel" id="{{ accordion_id }}" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
                {% with accordion_id|add:'-panel'|add:forloop_count as panel_id %}
                    <div class="panel-heading" role="tab" id="">

                        <div class="div_delete_object">
                            {% if formset.can_delete %}
                                <span>{% trans "Delete" %}</span>
                                {{ form.form.DELETE }}
                            {% endif %}
                        </div>
                        <div class="{% if form.is_valid is False and form.errors %}text-danger{% endif %}">
                            <a href="#{{ panel_id }}" role="button" data-toggle="collapse" data-parent="{{ accordion_id }}" aria-expanded="true" aria-controls="{{ panel_id }}">
                            {% if form.instance|is_instance_exists %}
                                <b>{{ form.instance }}</b>
                            {% else %}
                                {{ inline.verbose_name }} #{{ forloop.counter }}
                            {% endif %}
                            </a>
                        </div>

                        <span class="clearfix"></span>
                    </div>
                    <div id="{{ panel_id }}" class="panel-collapse collapse{% if form.is_valid is False and form.errors %} in{% endif %}" role="tabpanel" aria-labelledly="{{ panel_id }}">

                    <div class="panel-body">

                        {% if form.non_field_errors %}
                            {% for error in form.non_field_errors %}
                                <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                        {% endif %}

                        {% for field in form %}

                            {% if field.is_readonly %}
                                <div class="form-group">
                                    <label for="" class="col-sm-2 control-label">{{ field.label }}</label>
                                    <div class="col-sm-10">
                                        {{ field }}
                                    </div>
                                </div>

                            {% else %}

                                {% if field.is_hidden %}
                                    {{ field }}
                                {% elif field.name != 'DELETE' %}

                                    <div class="form-group">
                                        <label for="{{ field.id_for_label }}" class="col-sm-2 control-label">{{ field.label }}</label>
                                        <div class="col-sm-10">
                                            {% if field.errors %}
                                              {% for error in field.errors %}
                                                <p class="text-danger">{{ error }}</p>
                                              {% endfor %}
                                            {% endif %}
                                            {{ field }}
                                            <p class="help-block">{{ field.help_text }}</p>
                                        </div>
                                    </div>

                                {% endif %}
                            {% endif %}

                        {% endfor %}
                    </div>
                </div>
                {% endwith %}
            </div>
        </div>

        {% endwith %}
    {% endwith %}
{% endfor %}
